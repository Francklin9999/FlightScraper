// const test_data_cheapflightsData = {
//     "site": "Cheapflights",
//     "texts": [
//       {
//         "price": "C$ 328",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/UA.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c95e6df5bcf556791991bfcdc6e1763",
//         "airline": "United Airlines",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 328",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/UA.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c95e6df5bcf556791991bfcdc6e1763",
//         "airline": "United Airlines",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 328",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 384",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "1:10 pm – 10:20 pm",
//           "stop": "1 stop",
//           "duration": "9h 10m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 415",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/UA.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c95e6df5bcf556791991bfcdc6e1763",
//         "airline": "United Airlines",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "3:55 pm – 8:53 pm",
//           "stop": "1 stop",
//           "duration": "4h 58m"
//         }
//       },
//       {
//         "price": "C$ 415",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "3:55 pm – 8:53 pm",
//           "stop": "1 stop",
//           "duration": "4h 58m"
//         }
//       },
//       {
//         "price": "C$ 415",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/UA.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c95e6df5bcf556791991bfcdc6e1763",
//         "airline": "United Airlines",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "3:55 pm – 9:18 pm",
//           "stop": "1 stop",
//           "duration": "5h 23m"
//         }
//       },
//       {
//         "price": "C$ 415",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "3:55 pm – 9:18 pm",
//           "stop": "1 stop",
//           "duration": "5h 23m"
//         }
//       },
//       {
//         "price": "C$ 415",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:30 pm – 9:27 pm",
//           "stop": "direct",
//           "duration": "1h 57m"
//         },
//         "returnData": {
//           "time": "9:45 am – 3:18 pm",
//           "stop": "1 stop",
//           "duration": "5h 33m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "10:10 am – 3:00 pm",
//           "stop": "1 stop",
//           "duration": "4h 50m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "9:10 am – 3:00 pm",
//           "stop": "1 stop",
//           "duration": "5h 50m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "8:40 am – 3:00 pm",
//           "stop": "2 stops",
//           "duration": "6h 20m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "8:10 am – 3:00 pm",
//           "stop": "1 stop",
//           "duration": "6h 50m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:55 am – 3:00 pm",
//           "stop": "2 stops",
//           "duration": "7h 05m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       },
//       {
//         "price": "C$ 428",
//         "img": "https://content.r9cdn.net/rimg/provider-logos/airlines/v/AC.png?crop=false&width=108&height=92&fallback=default1.png&_v=0c9c508395bb634d0a68fb50eb9f3c57",
//         "airline": "Air Canada",
//         "departureData": {
//           "time": "7:55 am – 3:00 pm",
//           "stop": "2 stops",
//           "duration": "7h 05m"
//         },
//         "returnData": {
//           "time": "10:05 am – 11:32 am",
//           "stop": "direct",
//           "duration": "1h 27m"
//         }
//       }
//     ],
//     "url": "https://www.cheapflights.ca/flight-search/YUL-JFK/2024-10-09/2024-11-09?sort=price_a",
//     "adultNumber": 1,
//     "class": "Economy"
//   }


const convertDurationToMinutes = (duration) => {
    const match = duration.match(/(\d+)h\s*(\d*)m?/);
    const hours = match ? parseInt(match[1], 10) : 0;
    const minutes = match && match[2] ? parseInt(match[2], 10) : 0;
    return (hours * 60) + minutes;
};

const convertPriceToInteger = (price) => {
    const priceNumber = price.replace(/[^0-9]/g, '');
    return parseInt(priceNumber, 10);
};

export const transformCheapflightsData = (data) => {
    const { site, texts, url, adultNumber, class: flightClass } = data;

    const transformedFlights = texts.map(flight => {
        const departureDuration = convertDurationToMinutes(flight.departureData.duration);
        const returnDuration = convertDurationToMinutes(flight.returnData.duration);
        const totalDuration = departureDuration + returnDuration;
        const price = convertPriceToInteger(flight.price);

        return {
            site,
            price,
            img: flight.img,
            airline: flight.airline,
            departureData: {
                time: flight.departureData.time,
                stop: flight.departureData.stop,
                duration: departureDuration
            },
            returnData: {
                time: flight.returnData.time,
                stop: flight.returnData.stop,
                duration: returnDuration
            },
            totalDuration,
            url,
            adultNumber,
            class: flightClass
        };
    });

    const totalDurationArray = transformedFlights.map(flight => flight.totalDuration);
    const totalDurationSum = totalDurationArray.reduce((acc, duration) => acc + duration, 0);

    return [{
        site: site,
        totalDuration: totalDurationSum,
        price: null,
        img: null,
        airline: null,
        departureData: {
            time: null,
            stop: null,
            duration: null
        },
        returnData: {
            time: null,
            stop: null,
            duration: null
        },
        url: null,
        adultNumber: null,
        class: flightClass
    }, ...transformedFlights];
};

// const transformedData = transformCheapflightsData(test_data_cheapflightsData);

// console.log(transformedData);